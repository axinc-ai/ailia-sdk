<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ailia_speech: API Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ailia_speech
   &#160;<span id="projectnumber">0.9.7.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">API Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md4"></a>
Overview of ailia Speech API</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
Basic usage</h2>
<p>With ailia Speech, you can create an instance with <code>ailiaSpeechCreate</code>, then open a model with <code>ailiaSpeechOpenModelFile</code>, input a PCM with <code>ailiaSpeechPushInputData</code>, check that enough PCM has been fed with <code>ailiaSpeechBuffered</code>, transcribe into text with <code>ailiaSpeechTranscribe</code>, and then get the resulting text with <code>ailiaSpeechGetText</code>.</p>
<p>With <code>ailiaSpeechPushInputData</code> it is not necessary to input the whole audio data at once, it is possible to feed it little by little, so that it can be used in real-time with the input from a microphone.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;ailia.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ailia_audio.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ailia__speech_8h.html">ailia_speech.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ailia_speech_util.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main(<span class="keywordtype">void</span>){</div>
<div class="line"> <span class="comment">// Create the ailia Speech instance</span></div>
<div class="line"> <span class="keyword">struct </span>AILIASpeech* net;</div>
<div class="line"> <a class="code" href="struct__AILIASpeechApiCallback.html">AILIASpeechApiCallback</a> callback = ailiaSpeechUtilGetCallback();</div>
<div class="line"> <span class="keywordtype">int</span> memory_mode = AILIA_MEMORY_REDUCE_CONSTANT | AILIA_MEMORY_REDUCE_CONSTANT_WITH_INPUT_INITIALIZER | AILIA_MEMORY_REUSE_INTERSTAGE;</div>
<div class="line"> <a class="code" href="ailia__speech_8h.html#acffff23d4e9290777720557cdc30f9fc">ailiaSpeechCreate</a>(&amp;net, AILIA_ENVIRONMENT_ID_AUTO, AILIA_MULTITHREAD_AUTO, memory_mode, <a class="code" href="ailia__speech_8h.html#a6f87fdadb3ef26a39a787c4891c1a27e">AILIA_SPEECH_TASK_TRANSCRIBE</a>, <a class="code" href="ailia__speech_8h.html#a811a53f90bad34ceb1cd1cdf275c2687">AILIA_SPEECH_FLAG_NONE</a>, callback, <a class="code" href="ailia__speech_8h.html#a270b7093c3050b79117027ab17a87313">AILIA_SPEECH_API_CALLBACK_VERSION</a>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Load the model file</span></div>
<div class="line"> <a class="code" href="ailia__speech_8h.html#a56c22024e9f672509d2e00543ca14b95">ailiaSpeechOpenModelFileA</a>(net, <span class="stringliteral">&quot;encoder_small.onnx&quot;</span>, <span class="stringliteral">&quot;decoder_small_fix_kv_cache.onnx&quot;</span>, <a class="code" href="ailia__speech_8h.html#a57d4a103b11eb5eee22d1c559c18e446">AILIA_SPEECH_MODEL_TYPE_WHISPER_MULTILINGUAL_SMALL</a>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set the language</span></div>
<div class="line"> <a class="code" href="ailia__speech_8h.html#a72dd0b016ca262c66485a2fccc22627f">ailiaSpeechSetLanguage</a>(net, <span class="stringliteral">&quot;ja&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Gather and feed the input PCM</span></div>
<div class="line"> <a class="code" href="ailia__speech_8h.html#a453c7c1308539e9bc89239bfd9d0e831">ailiaSpeechPushInputData</a>(net, pPcm, nChannels, nSamples, sampleRate);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Transcribe</span></div>
<div class="line"> <span class="keywordflow">while</span>(<span class="keyword">true</span>){</div>
<div class="line">  <span class="comment">// Check that enough PCM has been fed to perform the transcription</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buffered = 0;</div>
<div class="line">  <a class="code" href="ailia__speech_8h.html#a0e0cb6e4b463dbf02fc5da05a061cedd">ailiaSpeechBuffered</a>(net, &amp;buffered);</div>
<div class="line">  <span class="keywordflow">if</span> (buffered == 1){</div>
<div class="line">   <span class="comment">// Do the transcription</span></div>
<div class="line">   <a class="code" href="ailia__speech_8h.html#adb4f738437f4663bf6cc12bb088cecfc">ailiaSpeechTranscribe</a>(net);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Get the amount of text fragments that have been transcribed</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count = 0;</div>
<div class="line">   <a class="code" href="ailia__speech_8h.html#a848b4bd906ed522b28e99b4be4696e74">ailiaSpeechGetTextCount</a>(net, &amp;count);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Get the transcribed text</span></div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = 0; idx &lt; count; idx++){</div>
<div class="line">    <a class="code" href="struct__AILIASpeechText.html">AILIASpeechText</a> text;</div>
<div class="line">    <a class="code" href="ailia__speech_8h.html#a608a04f5e2018a5f608480e6da3a16a9">ailiaSpeechGetText</a>(net, &amp;text, <a class="code" href="ailia__speech_8h.html#ad0c10a4d128016e1aab69aa593774875">AILIA_SPEECH_TEXT_VERSION</a>, idx);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> cur_time = text.<a class="code" href="struct__AILIASpeechText.html#afa317ae0e97f34bf603bf174fa57638b">time_stamp_begin</a>;</div>
<div class="line">    <span class="keywordtype">float</span> next_time = text.<a class="code" href="struct__AILIASpeechText.html#aa68dc0ba9cda57315271a26a574561c4">time_stamp_end</a>;</div>
<div class="line">    printf(<span class="stringliteral">&quot;[%02d:%02d.%03d --&gt; %02d:%02d.%03d] &quot;</span>, (<span class="keywordtype">int</span>)cur_time/60%60,(<span class="keywordtype">int</span>)cur_time%60, (<span class="keywordtype">int</span>)(cur_time*1000)%1000, (<span class="keywordtype">int</span>)next_time/60%60,(<span class="keywordtype">int</span>)next_time%60, (<span class="keywordtype">int</span>)(next_time*1000)%1000);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s\n&quot;</span>, text.<a class="code" href="struct__AILIASpeechText.html#ae53e0da708907b4ccd40ba796fa97833">text</a>);</div>
<div class="line">   }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Check if all of the PCM has been processed</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> complete = 0;</div>
<div class="line">  <a class="code" href="ailia__speech_8h.html#aa610ce4758daf48552da5f172fc0d972">ailiaSpeechComplete</a>(net, &amp;complete);</div>
<div class="line">  <span class="keywordflow">if</span> (complete == 1){</div>
<div class="line">   <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Destroy the ailia Speech instance</span></div>
<div class="line"> <a class="code" href="ailia__speech_8h.html#a078f8233d17bce5e1c3e707b226db2b5">ailiaSpeechDestroy</a>(net);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
How to modify the example for live transcription</h2>
<p>To enable live transcription, pass the flag AILIA_SPEECH_FLAG_LIVE to ailiaSpeechCreate.</p>
<div class="fragment"><div class="line"><a class="code" href="ailia__speech_8h.html#acffff23d4e9290777720557cdc30f9fc">ailiaSpeechCreate</a>(&amp;net, AILIA_ENVIRONMENT_ID_AUTO, AILIA_MULTITHREAD_AUTO, memory_mode, <a class="code" href="ailia__speech_8h.html#a6f87fdadb3ef26a39a787c4891c1a27e">AILIA_SPEECH_TASK_TRANSCRIBE</a>, <a class="code" href="ailia__speech_8h.html#a5101766abc42f4966dcc67b6cb2acd10">AILIA_SPEECH_FLAG_LIVE</a>, callback, <a class="code" href="ailia__speech_8h.html#a270b7093c3050b79117027ab17a87313">AILIA_SPEECH_API_CALLBACK_VERSION</a>);</div>
</div><!-- fragment --><p>The transcription preview is notified by being passed in argument to IntermediateCallback.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> intermediate_callback(<span class="keywordtype">void</span> *handle, <span class="keyword">const</span> <span class="keywordtype">char</span> *text){</div>
<div class="line"> printf(<span class="stringliteral">&quot;%s\n&quot;</span>, text);</div>
<div class="line"> <span class="keywordflow">return</span> 0; <span class="comment">// return 1 to interrupt</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="ailia__speech_8h.html#a6c25986e571ce83f49b523e2b59607da">ailiaSpeechSetIntermediateCallback</a>(net, &amp;intermediate_callback, NULL);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
GPU usage</h2>
<p>In order to use the GPU, pass the env_id corresponding to the GPU as the <code>env_id</code> argument of <code>ailiaSpeechCreate</code>. By default, the value AILIA_ENVIRONMENT_ID_AUTO is used, which indicates to perform the inference on the CPU. See <code>ailia_speech_sample.cpp</code> as an example of how to determine the GPU env_id to be passed as the <code>env_id</code> argument. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aailia__speech_8h_html_a078f8233d17bce5e1c3e707b226db2b5"><div class="ttname"><a href="ailia__speech_8h.html#a078f8233d17bce5e1c3e707b226db2b5">ailiaSpeechDestroy</a></div><div class="ttdeci">void AILIA_API ailiaSpeechDestroy(struct AILIASpeech *net)</div><div class="ttdoc">It destroys the network instance.</div></div>
<div class="ttc" id="aailia__speech_8h_html_a453c7c1308539e9bc89239bfd9d0e831"><div class="ttname"><a href="ailia__speech_8h.html#a453c7c1308539e9bc89239bfd9d0e831">ailiaSpeechPushInputData</a></div><div class="ttdeci">int AILIA_API ailiaSpeechPushInputData(struct AILIASpeech *net, const float *src, unsigned int channels, unsigned int samples, unsigned int sampling_rate)</div><div class="ttdoc">Push PCM data to queue.</div></div>
<div class="ttc" id="aailia__speech_8h_html_ad0c10a4d128016e1aab69aa593774875"><div class="ttname"><a href="ailia__speech_8h.html#ad0c10a4d128016e1aab69aa593774875">AILIA_SPEECH_TEXT_VERSION</a></div><div class="ttdeci">#define AILIA_SPEECH_TEXT_VERSION</div><div class="ttdoc">Struct version.</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:316</div></div>
<div class="ttc" id="astruct__AILIASpeechText_html_ae53e0da708907b4ccd40ba796fa97833"><div class="ttname"><a href="struct__AILIASpeechText.html#ae53e0da708907b4ccd40ba796fa97833">_AILIASpeechText::text</a></div><div class="ttdeci">const char * text</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:319</div></div>
<div class="ttc" id="aailia__speech_8h_html_aa610ce4758daf48552da5f172fc0d972"><div class="ttname"><a href="ailia__speech_8h.html#aa610ce4758daf48552da5f172fc0d972">ailiaSpeechComplete</a></div><div class="ttdeci">int AILIA_API ailiaSpeechComplete(struct AILIASpeech *net, unsigned int *complete)</div><div class="ttdoc">Determines whether all data has been processed.</div></div>
<div class="ttc" id="astruct__AILIASpeechApiCallback_html"><div class="ttname"><a href="struct__AILIASpeechApiCallback.html">_AILIASpeechApiCallback</a></div><div class="ttdef"><b>Definition:</b> ailia_speech.h:247</div></div>
<div class="ttc" id="aailia__speech_8h_html_a72dd0b016ca262c66485a2fccc22627f"><div class="ttname"><a href="ailia__speech_8h.html#a72dd0b016ca262c66485a2fccc22627f">ailiaSpeechSetLanguage</a></div><div class="ttdeci">int AILIA_API ailiaSpeechSetLanguage(struct AILIASpeech *net, const char *language)</div><div class="ttdoc">Set language.</div></div>
<div class="ttc" id="aailia__speech_8h_html_a56c22024e9f672509d2e00543ca14b95"><div class="ttname"><a href="ailia__speech_8h.html#a56c22024e9f672509d2e00543ca14b95">ailiaSpeechOpenModelFileA</a></div><div class="ttdeci">int AILIA_API ailiaSpeechOpenModelFileA(struct AILIASpeech *net, const char *encoder_path, const char *decoder_path, int model_type)</div><div class="ttdoc">Set models into a network instance.</div></div>
<div class="ttc" id="astruct__AILIASpeechText_html_afa317ae0e97f34bf603bf174fa57638b"><div class="ttname"><a href="struct__AILIASpeechText.html#afa317ae0e97f34bf603bf174fa57638b">_AILIASpeechText::time_stamp_begin</a></div><div class="ttdeci">float time_stamp_begin</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:320</div></div>
<div class="ttc" id="aailia__speech_8h_html_a270b7093c3050b79117027ab17a87313"><div class="ttname"><a href="ailia__speech_8h.html#a270b7093c3050b79117027ab17a87313">AILIA_SPEECH_API_CALLBACK_VERSION</a></div><div class="ttdeci">#define AILIA_SPEECH_API_CALLBACK_VERSION</div><div class="ttdoc">Struct version.</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:244</div></div>
<div class="ttc" id="aailia__speech_8h_html_acffff23d4e9290777720557cdc30f9fc"><div class="ttname"><a href="ailia__speech_8h.html#acffff23d4e9290777720557cdc30f9fc">ailiaSpeechCreate</a></div><div class="ttdeci">int AILIA_API ailiaSpeechCreate(struct AILIASpeech **net, int env_id, int num_thread, int memory_mode, int task, int flags, AILIASpeechApiCallback callback, int version)</div><div class="ttdoc">Creates a network instance.</div></div>
<div class="ttc" id="aailia__speech_8h_html_a6c25986e571ce83f49b523e2b59607da"><div class="ttname"><a href="ailia__speech_8h.html#a6c25986e571ce83f49b523e2b59607da">ailiaSpeechSetIntermediateCallback</a></div><div class="ttdeci">int AILIA_API ailiaSpeechSetIntermediateCallback(struct AILIASpeech *net, AILIA_SPEECH_USER_API_INTERMEDIATE_CALLBACK callback, void *handle)</div><div class="ttdoc">Set a callback to get intermediate results of recognition.</div></div>
<div class="ttc" id="aailia__speech_8h_html_a5101766abc42f4966dcc67b6cb2acd10"><div class="ttname"><a href="ailia__speech_8h.html#a5101766abc42f4966dcc67b6cb2acd10">AILIA_SPEECH_FLAG_LIVE</a></div><div class="ttdeci">#define AILIA_SPEECH_FLAG_LIVE</div><div class="ttdoc">Enable live transcribe mode.</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:154</div></div>
<div class="ttc" id="aailia__speech_8h_html_adb4f738437f4663bf6cc12bb088cecfc"><div class="ttname"><a href="ailia__speech_8h.html#adb4f738437f4663bf6cc12bb088cecfc">ailiaSpeechTranscribe</a></div><div class="ttdeci">int AILIA_API ailiaSpeechTranscribe(struct AILIASpeech *net)</div><div class="ttdoc">Speech recognition.</div></div>
<div class="ttc" id="aailia__speech_8h_html_a811a53f90bad34ceb1cd1cdf275c2687"><div class="ttname"><a href="ailia__speech_8h.html#a811a53f90bad34ceb1cd1cdf275c2687">AILIA_SPEECH_FLAG_NONE</a></div><div class="ttdeci">#define AILIA_SPEECH_FLAG_NONE</div><div class="ttdoc">Default flag.</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:143</div></div>
<div class="ttc" id="aailia__speech_8h_html_a0e0cb6e4b463dbf02fc5da05a061cedd"><div class="ttname"><a href="ailia__speech_8h.html#a0e0cb6e4b463dbf02fc5da05a061cedd">ailiaSpeechBuffered</a></div><div class="ttdeci">int AILIA_API ailiaSpeechBuffered(struct AILIASpeech *net, unsigned int *buffered)</div><div class="ttdoc">Determines if there is enough data to perform speech recognition.</div></div>
<div class="ttc" id="astruct__AILIASpeechText_html"><div class="ttname"><a href="struct__AILIASpeechText.html">_AILIASpeechText</a></div><div class="ttdef"><b>Definition:</b> ailia_speech.h:318</div></div>
<div class="ttc" id="aailia__speech_8h_html_a6f87fdadb3ef26a39a787c4891c1a27e"><div class="ttname"><a href="ailia__speech_8h.html#a6f87fdadb3ef26a39a787c4891c1a27e">AILIA_SPEECH_TASK_TRANSCRIBE</a></div><div class="ttdeci">#define AILIA_SPEECH_TASK_TRANSCRIBE</div><div class="ttdoc">Transcribe mode.</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:91</div></div>
<div class="ttc" id="aailia__speech_8h_html"><div class="ttname"><a href="ailia__speech_8h.html">ailia_speech.h</a></div></div>
<div class="ttc" id="aailia__speech_8h_html_a848b4bd906ed522b28e99b4be4696e74"><div class="ttname"><a href="ailia__speech_8h.html#a848b4bd906ed522b28e99b4be4696e74">ailiaSpeechGetTextCount</a></div><div class="ttdeci">int AILIA_API ailiaSpeechGetTextCount(struct AILIASpeech *net, unsigned int *count)</div><div class="ttdoc">Get text count.</div></div>
<div class="ttc" id="aailia__speech_8h_html_a57d4a103b11eb5eee22d1c559c18e446"><div class="ttname"><a href="ailia__speech_8h.html#a57d4a103b11eb5eee22d1c559c18e446">AILIA_SPEECH_MODEL_TYPE_WHISPER_MULTILINGUAL_SMALL</a></div><div class="ttdeci">#define AILIA_SPEECH_MODEL_TYPE_WHISPER_MULTILINGUAL_SMALL</div><div class="ttdoc">Whisper Small model.</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:65</div></div>
<div class="ttc" id="aailia__speech_8h_html_a608a04f5e2018a5f608480e6da3a16a9"><div class="ttname"><a href="ailia__speech_8h.html#a608a04f5e2018a5f608480e6da3a16a9">ailiaSpeechGetText</a></div><div class="ttdeci">int AILIA_API ailiaSpeechGetText(struct AILIASpeech *net, AILIASpeechText *text, unsigned int version, unsigned int idx)</div><div class="ttdoc">Get text length.</div></div>
<div class="ttc" id="astruct__AILIASpeechText_html_aa68dc0ba9cda57315271a26a574561c4"><div class="ttname"><a href="struct__AILIASpeechText.html#aa68dc0ba9cda57315271a26a574561c4">_AILIASpeechText::time_stamp_end</a></div><div class="ttdeci">float time_stamp_end</div><div class="ttdef"><b>Definition:</b> ailia_speech.h:321</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
